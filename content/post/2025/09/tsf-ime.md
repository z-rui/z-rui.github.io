---
date: 2025-09-26T23:56:15-07:00
title: Windows下基于TSF的自制输入法
---

7年前我自制了一个[基于ibus的输入法]({{<ref "/post/2017/12/ibus" >}})。我到现在还是很喜欢这个输入法方案，因为它非常简单，可定制性高，也没有外部依赖。唯一的问题就是显得太“笨”了，没有智能组词（句）的功能。

现在更常用WSL了，没法继续用ibus了。Windows上的微软拼音勉强可用（毕竟我也不需要什么高级功能），其他的“流氓”输入法就免了。但是我偶尔还是怀念那种老派的输入法体验（大概是因为我过时了吧……），所以花了一段时间研究这个问题。

<!--more-->

古代的Windows系统里有一个输入法生成器工具。市面上好像已经很难找到相关资料了，[这里有一个](https://think.lenovo.com.cn/htmls//detail_1256208863955405.html)。这个工具的作用就是根据一个“码表”（把编码转换为文本的表格）文件生成一个输入法。其实这也就是我想要的功能。时过境迁，现在的Windows早已不再提供这个工具了。原因至少有二：

1. 这种基于码表的办法，在现在“智能化”的大潮下显得过于原始了。用它制作的“全拼”输入法，输入效率极低：每个字都要输入完整的拼音，还要选字；词库里没有的词，只能拆开来输入。
2. Windows上的输入法框架从IMM32迁移到了TSF。原来的输入法编辑器不适用于TSF。输入法发展到现在，复杂度不可同日而语。再实现一个功能羸弱的输入法生成器的价值不大。

当然还有一个原因是用户对输入法的定制需求没有以前那么高了，基本上要么用系统自带的，要么用某个有名的商业软件。所以从微软的角度，可能干脆把微软拼音做得差不多就得了。

我在Windows Vista上见到过一个叫TableTextService的东西，它也可以根据一个码表生成一个输入法，但是微软只用它实现一些自带的输入法（比如仓颉），而没有给用户提供一个图形化的配置工具。这个TableTextService实际上也很不好用，操作上和传统的输入法不太一样。后来它好像也没有了。我已经搜不到官方的参考文档了。

我并没有自己用TSF写一个输入法出来。（标题有误导的嫌疑，非常抱歉。）据我所知，它和ibus非常不同。ibus是一个有界面的输入法框架，开发者在此基础上只需要实现将编码转换为候选列表这一功能即可。TSF则完全没有输入界面，所有东西都要由输入法自身实现。自己写GUI的工作量太大了，我现在不想造轮子了。

研究了一下有没有现成的方案，发现寥寥无几。网上能找到的最多的是[RIME输入法](https://rime.im/)。这个输入法的可定制性非常强，远远超过了传统的基于码表的输入法（可以接入任意引擎，所以完全可以实现一个智能的输入法），并且跨平台（它的Windows版本称为小狼毫,最新版本已经是基于TSF的了）。但是它也有一些问题：

1. 绝大多数配置只能通过修改YAML文件来实现。这个YAML文件究竟有哪些选项，相关文档并不是很齐全。这对于用户体验来说是个灾难。
2. 它的一些默认设置总觉得不太顺手。比如一些符号在中文模式下有奇怪默认值和候选项。这些都可以通过配置文件解决，但是这又回到了第一点：很多时候我不知道应该改哪一条配置。
3. 小狼毫偶尔有一些bug，导致“预编辑”文本（输入编码但尚未提交输入时，嵌入界面的文本）出现错乱。

除了RIME以外，还有多多输入法生成器和[小小输入法](https://github.com/dgod/yong)。它们大概相当于微软“输入法生成器”的增加版本。它们在智能输入方面可能比不上RIME，但是但是做一个基于码表的输入法可以说是绰绰有余了。

多多输入法生成器可以生成基于TSF的输入法（生成为一个安装程序），而且可以配置的选项也比较丰富。只是很可惜它不是开源软件，而且似乎开发团队的状态堪忧，文档也比较欠缺。好在它的操作比较直观（纯图形界面），应该不影响使用。

小小输入法我曾经（大约10年前）用过，功能大概更丰富一些，当时它应该只有基于IMM32的版本和一个“外挂”版本（即不是系统所认为的输入法，而是一个外部程序，往其他程序里发送文本消息）。现在它也有基于TSF的版本了。

这两个工具比RIME多了一个“无重码时隐藏候选框”的功能，很适合喜欢极简主义的人。

{{<figure src="/media/tsf-input-1.gif">}}